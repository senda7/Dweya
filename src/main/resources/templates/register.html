<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Créer un compte</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    :root {
      --container-color: #ffffff;
      --text-color: #333;
      --btn-bg: #74ebd5;
      --btn-hover: #5fc9bb;
      --btn-back-bg: #bbb;
      --btn-back-hover: #999;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #74ebd5, #ACB6E5);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container {
      background-color: var(--container-color);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 720px;
      text-align: center;
    }
    .logo {
      width: 110px;
      height: 110px;
      margin-bottom: 15px;
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    .app-title {
      font-size: 28px;
      font-weight: bold;
      color: #1e6b77;
      margin-bottom: 30px;
    }
    label {
      font-weight: bold;
      margin-bottom: 4px;
      display: block;
      color: var(--text-color);
      text-align: left;
    }
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="date"],
    select,
    input[type="file"] {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 16px;
      background-color: #fff;
      transition: border-color 0.3s, box-shadow 0.3s;
      box-sizing: border-box;
      font-size: 16px;
    }
    input:focus,
    select:focus {
      border-color: #74ebd5;
      outline: none;
      box-shadow: 0 0 6px rgba(116, 235, 213, 0.6);
    }
    .btn {
      width: 100%;
      padding: 14px;
      background-color: var(--btn-bg);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.1s;
      margin-top: 10px;
    }
    .btn:hover {
      background-color: var(--btn-hover);
    }
    .btn:active {
      transform: scale(0.98);
    }
    .btn-back {
      width: auto;
      padding: 8px 16px;
      background-color: var(--btn-back-bg);
      color: #333;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 20px;
      transition: background-color 0.3s;
      text-align: center;
    }
    .btn-back:hover {
      background-color: var(--btn-back-hover);
      color: #fff;
    }
    .link {
      display: block;
      text-align: center;
      margin-top: 18px;
      color: #555;
      text-decoration: none;
      font-size: 14px;
    }
    .link:hover {
      text-decoration: underline;
    }
    .error {
      color: red;
      text-align: center;
      margin-top: 15px;
      font-weight: 600;
    }
    .role-choice {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .role-choice label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
    }
    /* Animation fadeInSlide */
    .fadeInSlide {
      animation: fadeInSlideDown 0.5s ease forwards;
    }
    @keyframes fadeInSlideDown {
      0% {
        opacity: 0;
        transform: translateY(-20px);
        height: 0;
        overflow: hidden;
      }
      100% {
        opacity: 1;
        transform: translateY(0);
        height: auto;
        overflow: visible;
      }
    }
    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      text-align: left;
    }
  </style>
  <script th:inline="javascript">
    /*<![CDATA[*/
    // تحويل قائمة الأدوار من الباك إند إلى مصفوفة جافاسكريبت صحيحة
    const roles = /*[[${roles}]]*/ [];
    /*]]>*/
  </script>
  <script>
    function choisirRole(roleNom) {
      document.getElementById("choix-role").style.display = "none";

      const userForm = document.getElementById("form-utilisateur");
      const pharmaForm = document.getElementById("form-pharmacie");

      userForm.style.display = "none";
      pharmaForm.style.display = "none";

      userForm.classList.remove("fadeInSlide");
      pharmaForm.classList.remove("fadeInSlide");

      // البحث عن roleId حسب الاسم بحروف صغيرة
      const role = roles.find(r => r.nom.toLowerCase() === roleNom);
      const roleId = role ? role.id : null;

      if (roleNom === "utilisateur") {
        document.getElementById("roleId-utilisateur").value = roleId;
        userForm.style.display = "block";
        userForm.classList.add("fadeInSlide");
      } else if (roleNom === "pharmacie") {
        document.getElementById("roleId-pharmacie").value = roleId;
        pharmaForm.style.display = "block";
        pharmaForm.classList.add("fadeInSlide");
      }
    }

    function retourQuestion() {
      document.getElementById("choix-role").style.display = "block";

      const userForm = document.getElementById("form-utilisateur");
      const pharmaForm = document.getElementById("form-pharmacie");

      userForm.style.display = "none";
      pharmaForm.style.display = "none";

      userForm.classList.remove("fadeInSlide");
      pharmaForm.classList.remove("fadeInSlide");

      // إعادة تعيين أزرار الراديو
      const radios = document.getElementsByName("roleChoice");
      radios.forEach(r => r.checked = false);
    }
  </script>
</head>
<body>
<div class="container">
  <img th:src="@{/logo.png}" alt="Logo Dwaya" class="logo" />
  <h2 class="app-title">Créer un compte</h2>

  <!-- اختيار الدور -->
  <div id="choix-role">
    <p style="text-align:center; font-size:17px; margin-bottom:15px;">
      Vous voulez créer un compte en tant que :
    </p>
    <div class="role-choice">
      <label>
        <input type="radio" name="roleChoice" value="utilisateur" onclick="choisirRole('utilisateur')">
        Utilisateur
      </label>
      <label>
        <input type="radio" name="roleChoice" value="pharmacie" onclick="choisirRole('pharmacie')">
        Pharmacie
      </label>
    </div>
  </div>

  <!-- نموذج المستخدم -->
  <form th:action="@{/register}" method="post" th:object="${utilisateur}" enctype="multipart/form-data" id="form-utilisateur" style="display:none; text-align:left;">
    <button type="button" class="btn-back" onclick="retourQuestion()">← Retour</button>
    <input type="hidden" id="roleId-utilisateur" name="roleId" value="" />
    <label>Nom :</label>
    <input type="text" th:field="*{nom}" required />
    <label>Prénom :</label>
    <input type="text" th:field="*{prenom}" required />
    <label>Genre :</label>
    <select th:field="*{genre}" required>
      <option value="" selected>Choisissez votre genre</option>
      <option value="Homme">Homme</option>
      <option value="Femme">Femme</option>
      <option value="Autre">Autre</option>
    </select>
    <label>Date de naissance :</label>
    <input type="date" th:field="*{dateNaissance}" required />
    <label>Téléphone :</label>
    <input type="text" th:field="*{telephone}" required />
    <label>Email :</label>
    <input type="email" th:field="*{email}" required />
    <label>Adresse :</label>
    <input type="text" th:field="*{adresse}" required />
    <label>Ville :</label>
    <input type="text" th:field="*{ville}" required />
    <label>Mot de passe :</label>
    <input type="password" th:field="*{motDePasse}" required />

    <div class="checkbox-container">
      <input type="checkbox" id="cg-utilisateur" required />
      <label for="cg-utilisateur">
        J'accepte les <a href="/conditions" target="_blank">Conditions Générales</a>
      </label>
    </div>

    <button type="submit" class="btn">S’inscrire</button>
  </form>

  <!-- نموذج الصيدلية -->
  <form th:action="@{/register}" method="post" th:object="${utilisateur}" enctype="multipart/form-data" id="form-pharmacie" style="display:none; text-align:left;">
    <button type="button" class="btn-back" onclick="retourQuestion()">← Retour</button>
    <input type="hidden" id="roleId-pharmacie" name="roleId" value="" />
    <label>Nom de la pharmacie :</label>
    <input type="text" th:field="*{nomPharmacie}" required />
    <label>Nom du pharmacien:</label>
    <input type="text" th:field="*{nom}" required />
    <label>Prénom du pharmacien:</label>
    <input type="text" th:field="*{prenom}" required />
    <label>Numéro de licence :</label>
    <input type="text" th:field="*{numeroLicence}" required />
    <label>Numéro d’inscription à l’ordre :</label>
    <input type="text" th:field="*{numeroOrdre}" required />
    <label>Adresse complète :</label>
    <input type="text" th:field="*{adresse}" required />
    <label>Téléphone :</label>
    <input type="text" th:field="*{telephone}" required />
    <label>Email professionnel :</label>
    <input type="email" th:field="*{email}" required />
    <label>Extrait du registre de commerce :</label>
    <input type="file" th:field="*{registreCommerceFile}" accept=".pdf,.jpg,.jpeg,.png" required />
    <label>Carte d'identité du pharmacien :</label>
    <input type="file" th:field="*{cinPharmacienFile}" accept=".pdf,.jpg,.jpeg,.png" required />
    <label>Autorisation Ministère Santé :</label>
    <input type="file" th:field="*{autorisationMinistereFile}" accept=".pdf,.jpg,.jpeg,.png" required />
    <label>Mot de passe :</label>
    <input type="password" th:field="*{motDePasse}" required />

    <div class="checkbox-container">
      <input type="checkbox" id="cg-pharmacie" required />
      <label for="cg-pharmacie">

        J'accepte les <a th:href="@{/conditions}">Conditions Générales</a>
      </label>
    </div>

    <button type="submit" class="btn">S’inscrire</button>
  </form>

  <a class="link" href="/login">Vous avez déjà un compte ? Connectez-vous</a>
  <div th:if="${erreur}" th:text="${erreur}" class="error"></div>
</div>
</body>
</html>
